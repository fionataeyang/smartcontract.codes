const queryString = require('query-string')
const parsed = queryString.parse(location.search)

module.exports = pagination

function pagination (contracts) {
  let contractCount = contracts.length
  let cardsCount = 8 // cards displayed per page

  let currentPage = parsed.page ? parseInt(parsed.page) : 1
  let previousPage = currentPage == 1 ? null : currentPage - 1
  // let firstPage = 1
  let lastPage = contracts.length <= cardsCount ?
    null
    : Math.ceil(contractCount / cardsCount)
  let nextPage = lastPage != null && currentPage < lastPage ?
    currentPage + 1
    : null

  let pagesCount = Math.ceil(contracts.length / cardsCount)
  let datas = contracts.reduce((containers, el, i) => {
    const pos = Math.floor(i / cardsCount)
    const container = containers[pos]
    container.push(el)
    return containers
  }, [...Array(pagesCount)].map(_ => []))

  let currentData = datas[currentPage - 1]

  return {
    currentData,
    contractCount,
    cardsCount,
    previousPage,
    currentPage,
    lastPage,
    nextPage
  }

}
